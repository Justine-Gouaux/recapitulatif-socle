# SAISON 2 - SERVER

## Contenu

- [SAISON 2 - SERVER](#saison-2---server)
  - [Contenu](#contenu)
  - [Rôle d'un serveur](#rôle-dun-serveur)
  - [Localhost](#localhost)
  - [Apache](#apache)
  - [PHP](#php)
    - [Syntaxe PHP](#syntaxe-php)
      - [Variables](#variables)
      - [Types de données](#types-de-données)
        - [Scalaires](#scalaires)
        - [Constantes](#constantes)
        - [Composées](#composées)
          - [Tableaux simples (= *array*)](#tableaux-simples--array)
          - [Tableaux associatifs](#tableaux-associatifs)
          - [Opérations](#opérations)
          - [Concaténation](#concaténation)
    - [Combinaison HTML-PHP](#combinaison-html-php)
    - [Conditions](#conditions)
    - [Boucles PHP](#boucles-php)
      - [Boucles FOR](#boucles-for)
      - [Boucles WHILE](#boucles-while)
      - [Boucles FOREACH](#boucles-foreach)
    - [Fonctions](#fonctions)
  - [Formulaires](#formulaires)
    - [Formulaires HTML](#formulaires-html)
      - [Ressources](#ressources)
    - [Formulaires PHP et méthodes GET et POST](#formulaires-php-et-méthodes-get-et-post)
    - [Fonctions PHP (non exhaustif)](#fonctions-php-non-exhaustif)
      - [Organisation de code](#organisation-de-code)
      - [Manipulations de chaînes](#manipulations-de-chaînes)
      - [Tableaux](#tableaux)
      - [Mail](#mail)
      - [Serveur](#serveur)
    - [Documentation](#documentation)


## Rôle d'un serveur

Les navigateurs web communiquent avec les serveurs web en utilisant le protocole **HTTP** (**H**yper**T**ext **T**ransfer **P**rotocol). Un serveur est donc un logiciel capable d'interpréter les requêtes HTTP arrivant sur le port associé au protocole HTTP (par défaut le port 80), et de fournir une réponse avec ce même protocole.

Une requête HTTP inclut une URL pour identifier la ressource demandée, une **méthode** (ex. *GET* et *POST*, voir plus bas) pour définir l'action désirée et peut également inclure des informations supplémentaires encodées dans les **paramètres** de l'URL (des paires clés/valeurs envoyées via une chaîne de recherche = *query string*), les données POST, ou les cookies associés.

Les serveurs web attendent des requêtes du client, les traitent quand elles arrivent, et répondent au navigateur web avec une réponse HTTP. La réponse contient un **statut** qui indique si la requête a pu être traitée avec succès ou non.

Le corps de la réponse, si la requête réussit, contient alors la ressource demandée, que le navigateur web peut alors afficher.

![](https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_web_server/web-server.svg)

## Localhost

Localhost est une machine virtuelle à partir de laquelle un serveur Web est accessible *directement depuis son ordinateur*. Il permet de développer un projet Web sur son système sans avoir à télécharger le projet sur un serveur hébergé sur Internet.

## Apache

[Apache](https://www.apache.org/) est un logiciel de serveur Web, open source et gratuit.

Autres logiciels de gestion de serveurs Web courants : **Nginx**, **Microsoft IIS**, **LiteSpeed**.

## PHP

**PHP** (acronyme récursif pour **PHP Hypertext Preprocessor**) est un langage de scripts généraliste et Open Source, spécialement conçu pour le *développement d'applications web*. Il peut être intégré facilement au HTML.

PHP est principalement conçu pour servir de langage de script coté serveur; il permet donc de collecter des données de formulaire, générer du contenu dynamique, ou encore gérer des cookies.

### Syntaxe PHP

Les fichiers php ont l'extension `.php` et le code s'écrit entres balises `<?php>` et `?>`. Seule la balise ouvrante est nécessaire si le fichier contient exclusivement du PHP.

#### Variables

En PHP, les variables sont péfixées par `$`.
On assigne une valeur à une variable avec `=` , on peut l'afficher avec `echo` et l'inspecter grâce à `var_dump()` (affiche le type de donnée et son contenu).

#### Types de données

##### Scalaires

Les données *scalaires* contiennent un seul caractère.

- **string** : chaîne de caractères, écrite entre guillemets simmples `'` ou double `"` (on peut utiliser l'antislash `\` pour **échapper** un caractère, ou utiliser le caractère complémentaire dans ce cas)
- **int** : nombre entier
- **float** : nombre à virgules
- **boolean** : booléen, dont les deux valeurs possibles sont `true` ou `false`

##### Constantes

Une constante est un identifiant qui représente une **valeur simple**. Comme son nom le suggère, cette valeur **ne peut jamais être modifiée** durant l’exécution du script. Le nom d’une constante est sensible à la casse. Par convention, les constantes sont toujours **en majuscules**.

```
<?php
// Définition dune constante
define("AGE_MINI", 7);
define("AGE_MAXI", 77);
define("SITE_TITLE", "Mon super titre de site");

// Usage
echo '<title>'.SITE_TITLE.'</title>';
```

##### Composées

###### Tableaux simples (= *array*)

Pour stocker plusieurs infos dans une même variable.
`$salade_de_fruits = ["pomme", "poire", "banane", "kiwi"];`
On accède au rang **x** en faisant `$salade_de_fruits[x];`.

/!\ La numérotation des rangs (= index) commence **à 0**.

On peut rajouter des éléments au tableau après la déclaration de celui-ci :
`$salade_de_fruits[] = "rhum";`

###### Tableaux associatifs

On donne nous-mêmes les index au tableau, que l'on nomme **clés** (= *key*)

```
<?php>
$salade_de_fruits = [
    "gourmand" => "banane",
    "croquant => "pomme",
];
```

Accès à une valeur : `$salade_de_fruits["gourmand"];`

Ajout d'une valeur : `$salade_de_fruits["fondant"] = "mangue";`

Ecrasement d'un valeur : `$salade_de_fruits["croquant"] = "ananas";`

###### Opérations

On peut faire les opérations arithmétiques de base : `+`, `-`, `*`, `/`. Un `echo 2 + 2;` affichera 4.

###### Concaténation

On peu additionner plusieurs données de type différents grâce à la concaténation la concaténation, que l’on réalise
avec `.`.

On peut également utiliser des doubles-quotes `"` plutôt que les simples-quotes `'` pour afficher le contenu d’une variables.

```
<?php
$helper = `Loïc`;
echo $helper . 'va nous manquer après la formation';
echo "$helper va nous manquer après la formation";
``` 

### Combinaison HTML-PHP

Au lieu d'utiliser des tonnes de commandes afin d'afficher du HTML, les pages PHP contiennent des fragments HTML. Le code PHP est inclus entre une balise de début `<?php` et une balise de fin `?>` qui permettent au serveur web de passer en mode PHP.

Ce qui distingue PHP des langages de script comme le Javascript, est que le code est exécuté sur le serveur, générant ainsi le HTML, qui sera ensuite envoyé au client. Le client ne reçoit que le résultat du script, sans aucun moyen d'avoir accès au code qui a produit ce résultat.

### Conditions

On peut exécuter des actions en fonctions d'une condition grâce à la syntaxe `if($condition){ action; }`. L'action ne sera réalisée que si la condition est vérifiée 
(= renvoie `true`).

On peut définir plusieurs cas possibles avec `elseif` ainsi qu'une action à exécuter dans la cas où la condition est fause avec `else`.

La condition à vérifier peut être un boléen, une comparaison de valeur seule, une comparaison de valeur ET de type ou encore un test multiple grâce à des opérateurs logiques : `||` ( = OR , '*ou*') et `&&` ( = AND, '*et*').

La fonction `empty` permet de vérifier si une valeur est vide ou indéfinie, celle `isset` permet de vérifier si une variable est définie.

Il existe un **opérateur ternaire** s'écrivant `condition ? valeur si vrai : valeur si faux`.

Enfin, on peut utiliser l'**opérateur de fusion nulle** `$a ?? $b` pour éviter les inconvénients d’une variable qui pourrait être nulle.

### Boucles PHP

Les boucles permettent d'**exécuter une même série d'instructions plusieurs fois**.

#### Boucles FOR

Permet d'exécuter une même série d'instructions en incrémentant la variable à chaque fois.
On lui renseigne 3 instructions: *initialisation*, *condition* et *incrémentation*.

`for ($var = 0; $var < x; $var++) { instruction; }`

#### Boucles WHILE

Permet d'exécuter une série d'instruction respectant une condition définit.

`while (condition) { instruction; }`

#### Boucles FOREACH

Permet de parcourir des tableaux : `foreach ($arrayName as $ value) { instruction; } `

Ainsi que des tableaux associatifs : `foreach ($arrayName as $key => $value) { instruction; }`

### Fonctions

Une fonction correspond à un **ensemble d'instructions définies**. Ces instructions ne sont pas exécutées lors de la définition de la fonction mais de l'**appel** de celle-ci.

`function name() { instruction; } `

A chaque fois que l’on définit une fonction, on crée un nouvelle **portée de variables** . Une fonction est hermétique : tout ce qui est dans la fonction  n’est pas disponible en dehors et tout ce qui en dehors de la fonction n’est pas disponible à l’intérieur.

Si la fonction possède des **paramètres**, on peut lui fournir des **arguments**, qui pourront être modifiés à chaque appel de celle-ci.

`<function name($paramter1, $parameter2) { instruction; } `

Ces paramètres peuvent être optionnels, dans ce cas ils sont placés après ceux obligatoires et on leur founi une valeur par défaut.

`<function name($paramter1, $parameter2 = 'Default value') { instruction; } `

L'utilisation de `return` permet de retourner une valeur suite à l'exécution de la fonction.

**/!\ Un `return` implique la sortie de la fonction et doit donc être placée à la fin de celle-ci**

## Formulaires

### Formulaires HTML

Les formulaires HTML sont un des vecteurs principaux d'interaction entre un utilisateur et un site web ou une application. Ils permettent à l'utilisateur de leur envoyer des données.

Il est nécessaire de renseigner 2 attributs au foramulaire :
`action` qui contient l’adresse de la page où les informations du formulaire seront envoyées (la page actuelle si l'attribue est vide) et `method` défini la méthode utilisée pour envoyer ces données (GET ou POST).

Un formulaire HTML `<form>` est composé d'un ou plusieurs widgets. Ceux-ci peuvent être des zones de texte (sur une seule ligne : `<input>` ou plusieurs lignes : `<textarea>`), des boîtes à sélection `<select>`, des cases à cocher `<input type="checkbox">`, des boutons radio `<input type="radio">` et/ou des boutons `<button>`. La plupart du temps, ces items sont associés à un libellé `label` qui décrit leur rôle. Il est possible d’associer le label et le champ qu’il représente avec l’attribut `for` sur le label qui et l’attribut `id` placé sur l’élément en rapport.

Les champs souhaitant être utilisés pour transmettre des informations doivent posséder l’attribut `name` qui associe un nom à la future valeur, et des données peuvent être attribuées par défaut aux champs dans leur attribut `value`.

L'attribut `type` permet de spécifier le contenu attendu dans un champ texte (email, number, password,...), et l'attribut `placeholder` permet d’afficher à l’intérieur d’un champ vide la valeur attendue.

Afin d’envoyer les informations saisies, il faut un déclencheur qui peut être de 2 types:

- submit : `<input type="submit" value="Envoyer">`
- bouton : `<button>Envoyer</button>`

#### Ressources

- [Guide complet pour des formulaires web facilement utilisables (en)](https://www.smashingmagazine.com/2011/11/extensive-guide-web-form-usability/)
- [Concevoir un formulaire sur plusieurs pages (en)](https://www.uxmatters.com/mt/archives/2010/03/pagination-in-web-forms-evaluating-the-effectiveness-of-web-forms.php)

### Formulaires PHP et méthodes GET et POST

Lorsque l’on valide son formulaire, les informations présentes dans les champs
sont envoyés au serveur. PHP peut récupérer ses valeurs grâce aux variables
`$_GET` et `$_POST` (les variables commençant par `$_` sont des variables appelées **superglobales**, automatiquement assignées à PHP et qui n'ont donc pas besoin d'être déclarées).

Les valeurs sont remplies avec les attributs `name` des champs de formulaires.
On va pouvoir récupérer la valeur d’un champ avec `$_GET['nom-du-champ']` (par défaut) ou `$POST_['nom-du-champ']` (plus sécurisé car non public).

### Fonctions PHP (non exhaustif)

#### Organisation de code

- `include "fichier.ext"` : importe un fichier (ex: `header.php`, `footer.php`)
- `require "fichier.ext"` : importe un fichier et génère une erreur fatale si le fichier n'a pas été importé
- `include_once "fichier.ext"` et `require_once "fichier.ext"` : variantes qui vont s’assurer que le fichier n’a pas déjà été inclus

#### Manipulations de chaînes

- `date()` : retourne la date selon un format (ex `('j/m/Y')` )
- `strlen($string)` : retourne la longueur d’une chaîne de caractères
- `number_format($number, conditions)` : formate un nombre (= modifie son affichage)

#### Tableaux

- `count($array)` : retourne la longueur d'un tableau

#### Mail

- `mail($parameters)`: envoie un e-mail
- `filter_var($var, FILTER)`: filtre une variable suivant une condition

#### Serveur

- `header('Location: https://blabla.bla/')`: permet d’envoyer une en-tête HTTP (ex: redirection, 404,...)

### Documentation

- [php.net](https://www.php.net/docs.php)
